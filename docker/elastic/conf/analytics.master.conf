engines:
  - analytics

analytics:

  collectors:
    jobs-collector:
      plugin: event-bus
      tags:
        - "salt/job/*"

    grains-collector:
      plugin: grains
      interval: 30
      grains:
        - "os"
        - "id"
        - "role"
        - "datacenter"

  processors:
    job-aggregate:
      plugin: job-aggregate
    state-job-aggregate:
      plugin: job-aggregate
      jobs:
        - "state.*"
    cast-to-es:
      plugin: jobs_to_es
    state-cast-to-es:
      plugin: state_jobs_to_es

  forwarders:
    elasticsearch-forwarder:
      plugin: elasticsearch
      hosts:
        - http://node01:9200

  pipelines:

    jobs-pipeline:
      collect:
        - grains-collector
        - jobs-collector
      process:
        - job-aggregate
        - cast-to-es
      forward: elasticsearch-forwarder

    state-jobs-pipeline:
      collect:
        - grains-collector
        - jobs-collector
      process:
        - state-job-aggregate
        - state-cast-to-es
      forward: elasticsearch-forwarder
